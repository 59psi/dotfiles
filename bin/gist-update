#!/usr/bin/env bash -e
# update or clone public and private Gists to ~/src/gists

read -p "Username: " uname

TMPLATE=$(basename $0)
TMPFILE=$(mktemp /tmp/${TMPLATE}.XXXXXX)
GISTDIR=${HOME}/src/gists

curl -# -u ${uname} "https://api.github.com/users/${uname}/gists" -o ${TMPFILE}

for id in $(sed -En 's/^[ ]{4}"id": "([a-fA-F0-9]{6,40})"$/\1/p' < ${TMPFILE})
do
	if [[ -d "${GISTDIR}/gist-${id}" ]]
	then
		cd ${GISTDIR}/gist-${id}
		git pull
	else
		git clone git@gist.github.com:${id}.git "${GISTDIR}/gist-${id}"
	fi
done
