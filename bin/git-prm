#!/bin/sh
# Delete branches created by git-pr.
#
# This script uses git-cherry to determine if the commits
# on a branch have been merged into or cherry-picked onto
# some upstream branch. If they have, the branch is deleted.
#
# Set the upstream remote:	git config pr.remote <remote>
# Set the upstream branch:	git config pr.branch <branch>

set -e

remote=$(git config --get pr.remote)
branch=$(git config --get pr.branch)

for pr in $(git branch | grep -Eo "pr/[0-9]+")
do
	if git cherry "$remote/$branch" "$pr" | grep -q "^+"
	then continue
	else git branch -D "$pr"
	fi
done
