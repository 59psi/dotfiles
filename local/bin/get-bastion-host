#!/bin/sh
set -eu

unset AWS_VAULT AWS_SECRET_ACCESS_KEY AWS_ACCESS_KEY_ID AWS_SESSION_TOKEN AWS_SECURITY_TOKEN

env=$(\
  aws-vault exec "$1" -- \
  aws ec2 describe-instances \
  --filters "Name=private-ip-address,Values=${2}" \
  --query "Reservations[0].Instances[0].Tags[?Key==\`Environment\`].Value" \
  --output text
)

printf "bastion.%s" "$env"
